{"version":3,"sources":["predict_prostate/state/run_time.cljs"],"mappings":";AAYA,AAAKA,4CAAU,AAACC;AAGhB,wCAAA,xCAAKC;AACL,0CAAA,1CAAKC;AACL,oCAAA,pCAAKC;AAEL;;;6CAAA,7CAAMC,kGAEHC;AAFH,AAGE,OAACC,wBAAQD,UAAUN;;AAKrB,GAAA,QAAAQ,6CAAAC,mDAAAC,4DAAAC;AAAA;AAAA,AAAA,AAASC,uCACA,6CAAA,wCAAA,2DAAA,sFAAA,oEAAA,iEAAA,wEAAA,sEAAA,sDAAA,iEAAA,8EAAA,6DAAA,8EAAA,oEAAA,6EAAA,qEAAA,wDAAA,oDAAA,4FAAA,mFAAA,oWAAA,kCAAA,MAAA,KAAA,WAAA,eAAA,mFAAA,oDAAA,KAAA,aAAA,KAAA,MAAA,KAAA,kCAAA,cAAA,iDAAA,MAAA,yDAAA,OAAA,IAAA,SAAA,lkEAACC,w3CAsCgC,kFAAA,lFAACC,8CAAMC,sGAA4B,AAACC,yCAAgBC,iCAAa,AAACC,4BAAuBC;;AAInI,GAAA,QAAAX,6CAAAC,mDAAAC,4DAAAU;AAAA;AAAA,AAAA,AAASC,8CAAY,wDAAA,mFAAA,3IAACC,mBAAcV;;AACpC,GAAA,QAAAJ,6CAAAC,mDAAAC,4DAAAa;AAAA;AAAA,AAAA,AAASC,8CAAY,2CAAA,3CAACnB;;AACtB,GAAA,QAAAG,6CAAAC,mDAAAC,4DAAAe;AAAA;AAAA,AAAA,AAASC,kDAAgB,wDAAA,mFAAA,sDAAA,jMAACJ,mBAAcV;;AACxC,GAAA,QAAAJ,6CAAAC,mDAAAC,4DAAAiB;AAAA;AAAA,AAAA,AAASC,kDAAgB,2CAAA,3CAACvB;;AAE1B,GAAA,QAAAG,6CAAAC,mDAAAC,4DAAAmB;AAAA;AAAA,AAAA,AAASC,8CAAY,2CAAA,3CAACzB;;AACtB,GAAA,QAAAG,6CAAAC,mDAAAC,4DAAAqB;AAAA;AAAA,AAAA,AAASC,qDAAmB,2CAAA,3CAAC3B;;AAC7B,GAAA,QAAAG,6CAAAC,mDAAAC,4DAAAuB;AAAA;AAAA,AAAA,AAASC,+CAAa,2CAAA,3CAAC7B;;AACvB,GAAA,QAAAG,6CAAAC,mDAAAC,4DAAAyB;AAAA;AAAA,AAAA,AAASC,iDAAe,wDAAA,mFAAA,3IAACd,mBAAcV;;AACvC,GAAA,QAAAJ,6CAAAC,mDAAAC,4DAAA2B;AAAA;AAAA,AAAA,AAASC,iDAAe,2CAAA,3CAACjC;;AAEzB,GAAA,QAAAG,6CAAAC,mDAAAC,4DAAA6B;AAAA;AAAA,AAAA,AAASC,6CAAW,wDAAA,mFAAA,2DAAA,tMAAClB,mBAAcV;;AACnC,GAAA,QAAAJ,6CAAAC,mDAAAC,4DAAA+B;AAAA;AAAA,AAAA,AAASC,kDAAgB,2CAAA,3CAACrC;;AAG1B,GAAA,QAAAG,6CAAAC,mDAAAC,4DAAAiC;AAAA;AAAA,AAAA,AAASC,4CAAU,6CAAA,7CAAC/B;;AAGpB,GAAA,QAAAL,6CAAAC,mDAAAC,4DAAAmC;AAAA;AAAA,AAAA,AAASC,+CAAa,qDAAA,rDAACC,gBAAWnC;;AAClC,GAAA,QAAAJ,6CAAAC,mDAAAC,4DAAAsC;AAAA;AAAA,AAAA,AAASC,+CAAa,2CAAA,3CAAC5C;;AAKvB,GAAA,QAAAG,6CAAAC,mDAAAC,4DAAAwC;AAAA;AAAA,AAAA,AAASC,sDAAoB,qDAAA,rDAACJ,gBAAWnC;;AACzC,GAAA,QAAAJ,6CAAAC,mDAAAC,4DAAA0C;AAAA;AAAA,AAAA,AAASC,sDAAoB,2CAAA,3CAAChD;;AAE9B,GAAA,QAAAG,6CAAAC,mDAAAC,4DAAA4C;AAAA;AAAA,AAAA,AAASC,0DAAwB,qDAAA,rDAACR,gBAAWnC;;AAC7C,GAAA,QAAAJ,6CAAAC,mDAAAC,4DAAA8C;AAAA;AAAA,AAAA,AAASC,0DAAwB,2CAAA,3CAACpD;;AAElC,GAAA,QAAAG,6CAAAC,mDAAAC,4DAAAgD;AAAA;AAAA,AAAA,AAASC,wCAAM,qDAAA,rDAACZ,gBAAWnC;;AAC3B,GAAA,QAAAJ,6CAAAC,mDAAAC,4DAAAkD;AAAA;AAAA,AAAA,AAASC,+CAAa,2CAAA,3CAACxD;;AAEvB,GAAA,QAAAG,6CAAAC,mDAAAC,4DAAAoD;AAAA;AAAA,AAAA,AAASC,qDAAmB,qDAAA,rDAAChB,gBAAWnC;;AACxC,GAAA,QAAAJ,6CAAAC,mDAAAC,4DAAAsD;AAAA;AAAA,AAAA,AAASC,qDAAmB,2CAAA,3CAAC5D;;AAE7B,GAAA,QAAAG,6CAAAC,mDAAAC,4DAAAwD;AAAA;AAAA,AAAA,AAASC,sDAAoB,qDAAA,rDAACpB,gBAAWnC;;AACzC,GAAA,QAAAJ,6CAAAC,mDAAAC,4DAAA0D;AAAA;AAAA,AAAA,AAASC,sDAAoB,2CAAA,3CAAChE;;AAE9B,GAAA,QAAAG,6CAAAC,mDAAAC,4DAAA4D;AAAA;AAAA,AAAA,AAASC,kDAAgB,qDAAA,rDAACxB,gBAAWnC;;AACrC,GAAA,QAAAJ,6CAAAC,mDAAAC,4DAAA8D;AAAA;AAAA,AAAA,AAASC,kDAAgB,2CAAA,3CAACpE;;AAE1B,GAAA,QAAAG,6CAAAC,mDAAAC,4DAAAgE;AAAA;AAAA,AAAA,AAASC,kDAAgB,qDAAA,rDAAC5B,gBAAWnC;;AACrC,GAAA,QAAAJ,6CAAAC,mDAAAC,4DAAAkE;AAAA;AAAA,AAAA,AAASC,kDAAgB,2CAAA,3CAACxE;;AAE1B,GAAA,QAAAG,6CAAAC,mDAAAC,4DAAAoE;AAAA;AAAA,AAAA,AAASC,+CAAa,qDAAA,rDAAChC,gBAAWnC;;AAClC,GAAA,QAAAJ,6CAAAC,mDAAAC,4DAAAsE;AAAA;AAAA,AAAA,AAASC,+CAAa,2CAAA,3CAAC5E;;AAEvB,GAAA,QAAAG,6CAAAC,mDAAAC,4DAAAwE;AAAA;AAAA,AAAA,AAASC,8CAAY,qDAAA,rDAACpC,gBAAWnC;;AACjC,GAAA,QAAAJ,6CAAAC,mDAAAC,4DAAA0E;AAAA;AAAA,AAAA,AAASC,8CAAY,2CAAA,3CAAChF;;AAGtB,GAAA,QAAAG,6CAAAC,mDAAAC,4DAAA4E;AAAA;AAAA,AAAA,AAASC,0DAAwB,qDAAA,rDAACxC,gBAAWnC;;AAG7C,GAAA,QAAAJ,6CAAAC,mDAAAC,4DAAA8E;AAAA;AAAA,AAAA,AAASC,8DAA4B,qDAAA,rDAAC1C,gBAAWnC;;AAGjD,AAAK8E,sCAAID;AAET,GAAA,QAAAjF,6CAAAC,mDAAAC,4DAAAiF;AAAA;AAAA,AAAA,AAASC,iDAAe,2CAAA,3CAACvF;;AACzB,GAAA,QAAAG,6CAAAC,mDAAAC,4DAAAmF;AAAA;AAAA,AAAA,AAASC,iDAAe,qDAAA,rDAAC/C,gBAAWnC;;AAMpC,GAAA,QAAAJ,6CAAAC,mDAAAC,4DAAAqF;AAAA;AAAA,AAAA,AAASC,sDAAoB,qDAAA,rDAACjD,gBAAWnC;;AACzC,GAAA,QAAAJ,6CAAAC,mDAAAC,4DAAAuF;AAAA;AAAA,AAAA,AAASC,wDAAsB,2CAAA,3CAAC7F;;AAEhC,GAAA,QAAAG,6CAAAC,mDAAAC,4DAAAyF;AAAA;AAAA,AAAA,AAASC,gDAAc,qDAAA,rDAACrD,gBAAWnC;;AACnC,GAAA,QAAAJ,6CAAAC,mDAAAC,4DAAA2F;AAAA;AAAA,AAAA,AAASC,gDAAc,2CAAA,3CAACjG;;AAExB,GAAA,QAAAG,6CAAAC,mDAAAC,4DAAA6F;AAAA;AAAA,AAAA,AAASC,sDAAoB,2CAAA,3CAACnG;;AAM9B,gDAAA,hDAAMoG;AAAN,AACE,sDAAA,AAAAC,sDAAA,mFAAA,sEAAA,9PAACC,+DAAQ/F;;AAGX,+CAAA,/CAAMgG,sGAAcC;AAApB,AACE,sDAAA,AAAAH,sDAAA,mFAAA,sEAAA,9PAACC,+DAAQ/F,wPAA4BiG;;AAGvC,gDAAA,hDAAMC;AAAN,AACE,sDAAA,AAAAJ,sDAAA,mFAAA,sEAAA,9PAACC,+DAAQ/F;;AAEX,+CAAA,/CAAMmG,sGAAcF;AAApB,AACE,sDAAA,AAAAH,sDAAA,mFAAA,sEAAA,9PAACC,+DAAQ/F,yPAA4BiG;;AAEvC,8CAAA,9CAAMG,oGAAaH;AAAnB,AACE,sDAAA,AAAAH,sDAAA,mFAAA,sEAAA,9PAACC,+DAAQ/F,sPAA2BiG;;AAEtC,gDAAA,hDAAMI,wGAAeJ;AAArB,AACE,sDAAA,AAAAH,sDAAA,mFAAA,sEAAA,9PAACC,+DAAQ/F,2PAA6BiG;;AAExC,+CAAA,/CAAMK,sGAAcL;AAApB,AACE,sDAAA,AAAAH,sDAAA,mFAAA,sEAAA,9PAACC,+DAAQ/F,wPAA4BiG;;AAEvC,+CAAA,/CAAMM,sGAAcN;AAApB,AACE,sDAAA,AAAAH,sDAAA,mFAAA,sEAAA,9PAACC,+DAAQ/F,wPAA4BiG;;AAEvC;;;;4CAAA,5CAAMO;AAAN,AAIE,oDAAA,7CAACC,gFACK,AAACC,4CAAI,WAAAC;AAAA,AAAA,IAAAC,aAAAD;QAAA,AAAAE,4CAAAD,WAAA,IAAA,/DAAME;QAAN,AAAAD,4CAAAD,WAAA,IAAA,/DAAQG;AAAR,AAAA,4FAAA,AAAAjB,FAAagB,kBAAGC;GAChB,AAACC,+CAAO,WAAAC;AAAA,AAAA,IAAAC,aAAAD;QAAA,AAAAJ,4CAAAK,WAAA,IAAA,/DAAMJ;QAAN,AAAAD,4CAAAK,WAAA,IAAA,/DAAQC;AAAR,AACE,IAAAC,eAAC,gDAAA,AAAAtB,yEAAA,AAAAA,zHAACuB,gEAAO1C,yEAAyBE;AAAlC,AAAA,QAAAuC,6CAAAA,gDAAAA,LAA+DN,4BAAAA;GAAI,AAACjB;;AAG3F,gDAAA,hDAAMyB;AAAN,AAAA;AAEE,oDAAA,7CAACtB;;AAGH,+CAAA,/CAAMuB,sGAAQR;AAAd,AACE,0BAAA,jBAAI,MAAA,LAAMA,kBAAG,+CAAA,/CAACS,6CAAET,WAAM,EAAK,OAASA,oBAAG,GAAA,iEAAA,hEAAO,wDAAA,xDAACU,sDAASV;;AAE1D,sDAAA,tDAAMW,oHAAeZ;AAArB,AACE,oDAAA,AAAAhB,7CAACyB,6DAAQ,AAACvB,6CAAac;;AAGzB;;;;2DAAA,3DAAMa,8HAGHC;AAHH,AAIE,SAAK,cAAA,AAAA9B,dAAC+B,8BAAKlD,+DACN,AAACmD,uBAAO,WAAKhB;AAAL,AAAQ,IAAAiB,wBAAK,CAACH,0CAAAA,6CAAAA,LAAUd,yBAAAA;AAAhB,AAAA,oBAAAiB;AAAmB,UAAK,AAACL,oDAAcZ;;AAAvCiB;;GAAhB,AAAAjC,gBAA8DnB;;AAOrE","names":["predict-prostate.state.run-time/event-bus","pubsub.feeds/create-feed","predict-prostate.state.run-time/model","predict-prostate.state.run-time/unknown","predict-prostate.state.run-time/N","predict-prostate.state.run-time/make-topic","topic-key","pubsub.feeds/->Topic","js/predict-prostate","js/predict-prostate.state","js/predict-prostate.state.run-time","js/predict-prostate.state.run-time.rtdb","predict-prostate.state.run-time/rtdb","cljs.core.atom","cljs.core.assoc","translations.config/initial-t-state","translations.tongue-base/wrap-translator","translations.config/initial-lang","tongue.core/build-translate","translations.config/initial-translations","js/predict-prostate.state.run-time.edit-cursor","predict-prostate.state.run-time/edit-cursor","rum.core/cursor-in","js/predict-prostate.state.run-time.edit-change","predict-prostate.state.run-time/edit-change","js/predict-prostate.state.run-time.new-text-cursor","predict-prostate.state.run-time/new-text-cursor","js/predict-prostate.state.run-time.new-text-change","predict-prostate.state.run-time/new-text-change","js/predict-prostate.state.run-time.text-change","predict-prostate.state.run-time/text-change","js/predict-prostate.state.run-time.add-language-modal","predict-prostate.state.run-time/add-language-modal","js/predict-prostate.state.run-time.add-language","predict-prostate.state.run-time/add-language","js/predict-prostate.state.run-time.t-state-cursor","predict-prostate.state.run-time/t-state-cursor","js/predict-prostate.state.run-time.t-state-change","predict-prostate.state.run-time/t-state-change","js/predict-prostate.state.run-time.ttt-cursor","predict-prostate.state.run-time/ttt-cursor","js/predict-prostate.state.run-time.language-change","predict-prostate.state.run-time/language-change","js/predict-prostate.state.run-time.estimates","predict-prostate.state.run-time/estimates","js/predict-prostate.state.run-time.media-cursor","predict-prostate.state.run-time/media-cursor","rum.core/cursor","js/predict-prostate.state.run-time.media-change","predict-prostate.state.run-time/media-change","js/predict-prostate.state.run-time.hide-warning-cursor","predict-prostate.state.run-time/hide-warning-cursor","js/predict-prostate.state.run-time.hide-warning-change","predict-prostate.state.run-time/hide-warning-change","js/predict-prostate.state.run-time.show-uncertainty-cursor","predict-prostate.state.run-time/show-uncertainty-cursor","js/predict-prostate.state.run-time.show-uncertainty-change","predict-prostate.state.run-time/show-uncertainty-change","js/predict-prostate.state.run-time.route","predict-prostate.state.run-time/route","js/predict-prostate.state.run-time.route-change","predict-prostate.state.run-time/route-change","js/predict-prostate.state.run-time.help-header-cursor","predict-prostate.state.run-time/help-header-cursor","js/predict-prostate.state.run-time.help-header-change","predict-prostate.state.run-time/help-header-change","js/predict-prostate.state.run-time.help-content-cursor","predict-prostate.state.run-time/help-content-cursor","js/predict-prostate.state.run-time.help-content-change","predict-prostate.state.run-time/help-content-change","js/predict-prostate.state.run-time.help-key-cursor","predict-prostate.state.run-time/help-key-cursor","js/predict-prostate.state.run-time.help-key-change","predict-prostate.state.run-time/help-key-change","js/predict-prostate.state.run-time.settings-cursor","predict-prostate.state.run-time/settings-cursor","js/predict-prostate.state.run-time.settings-change","predict-prostate.state.run-time/settings-change","js/predict-prostate.state.run-time.print-cursor","predict-prostate.state.run-time/print-cursor","js/predict-prostate.state.run-time.print-change","predict-prostate.state.run-time/print-change","js/predict-prostate.state.run-time.help-cursor","predict-prostate.state.run-time/help-cursor","js/predict-prostate.state.run-time.help-change","predict-prostate.state.run-time/help-change","js/predict-prostate.state.run-time.on-screen-inputs-cursor","predict-prostate.state.run-time/on-screen-inputs-cursor","js/predict-prostate.state.run-time.on-screen-treatments-cursor","predict-prostate.state.run-time/on-screen-treatments-cursor","predict-prostate.state.run-time/ost","js/predict-prostate.state.run-time.results-change","predict-prostate.state.run-time/results-change","js/predict-prostate.state.run-time.results-cursor","predict-prostate.state.run-time/results-cursor","js/predict-prostate.state.run-time.active-results-pane","predict-prostate.state.run-time/active-results-pane","js/predict-prostate.state.run-time.active-results-change","predict-prostate.state.run-time/active-results-change","js/predict-prostate.state.run-time.mockup-cursor","predict-prostate.state.run-time/mockup-cursor","js/predict-prostate.state.run-time.mockup-change","predict-prostate.state.run-time/mockup-change","js/predict-prostate.state.run-time.force-recalculation","predict-prostate.state.run-time/force-recalculation","predict-prostate.state.run-time/input-cursors","cljs.core/deref","cljs.core.get_in","predict-prostate.state.run-time/input-cursor","key","predict-prostate.state.run-time/input-changes","predict-prostate.state.run-time/input-change","predict-prostate.state.run-time/input-label","predict-prostate.state.run-time/input-default","predict-prostate.state.run-time/input-widget","predict-prostate.state.run-time/input-access","predict-prostate.state.run-time/input-map","cljs.core.into","cljs.core.map","p__55253","vec__55254","cljs.core.nth","k","v","cljs.core.filter","p__55257","vec__55258","_","fexpr__55261","clojure.set.union","predict-prostate.state.run-time/year-selected","predict-prostate.state.run-time/error?","cljs.core._EQ_","clojure.string.index_of","predict-prostate.state.run-time/error-by-key?","predict-prostate.state.run-time/recalculate-model?","input-map","cljs.core/seq","cljs.core/every?","and__4210__auto__"],"sourcesContent":["(ns predict-prostate.state.run-time\n  (:require\n   [rum.core :as rum]\n   [clojure.string :refer [index-of]]\n   [clojure.set :refer [union]]\n   ;[predict-prostate.state.config :refer [initial-t-state]]\n   [translations.config :refer [initial-t-state initial-lang initial-translations]]\n   [pubsub.feeds :refer [->Topic create-feed]]\n   [translations.tongue-base :refer [wrap-translator]]\n   [tongue.core :as tongue]))\n\n\n(def event-bus (create-feed))\n\n\n(def model \"prostate-release\")\n(def unknown \"Unknown\")\n(def N 15)\n\n(defn make-topic\n  \"Make a new topic on which to report events\"\n  [topic-key]\n  (->Topic topic-key event-bus))\n\n\n\"When plotting adjuvant treatments, we start from a baseline of surgery only, adding treatments and hopefully improving\nsurvival, up to the projected survival of prostate-cancer-free men \"\n(defonce rtdb\n         (atom {;; Plot style\n                :plot-style              nil\n\n                :recalculate-error-state 0\n\n                :active-results-pane     \"charts\"\n                :active-mockup           \"Mockup 1\"         ;used for adverse effects mockups\n                :incomplete              true\n\n                ;; The set of widgets\n                :on-screen-inputs        #{}\n                :on-screen-treatments    #{}\n\n                :show-uncertainty        :no\n\n                ;; model results.\n                ;; These should be non-nil when all inputs are complete.\n                ;; Result data structure can be dependent on model\n                :results                 []\n\n                ;; active route\n                :route                   [:home nil nil]\n\n                ;; help\n                :help-key                nil\n                :help-header             \"Help header\"\n                :help-content            \"Help content\"\n\n                ;; settings modal initially not shown\n                :help-visible            false\n                :settings-visible        false\n\n                ;; The state of the tool left-column accordion\n                :hide-warning            false\n                :test                    \"test\"\n                :media                   :screen\n\n                ;; translations state\n                :t-state                  (assoc initial-t-state :translator (wrap-translator initial-lang (tongue/build-translate initial-translations)))\n                }))\n\n; The complete translations state (t-state) gets loaded from a URL of commands (usually dictionary.txt) at startup\n(defonce edit-cursor (rum/cursor-in rtdb [:edit]))\n(defonce edit-change (make-topic :edit-change))             ; change to the edit status of a field\n(defonce new-text-cursor (rum/cursor-in rtdb [:edit :new-text]))\n(defonce new-text-change (make-topic :new-text-change))\n\n(defonce text-change (make-topic :text-change))             ; change to the new-text in an edited field (use args [key new-text])\n(defonce add-language-modal (make-topic :add-language-modal))\n(defonce add-language (make-topic :add-language))\n(defonce t-state-cursor (rum/cursor-in rtdb [:t-state]))\n(defonce t-state-change (make-topic :t-state-change))\n\n(defonce ttt-cursor (rum/cursor-in rtdb [:t-state :translator]))\n(defonce language-change (make-topic :language-change))\n\n\n(defonce estimates (atom nil))\n\n\n(defonce media-cursor (rum/cursor rtdb :media))\n(defonce media-change (make-topic :media-change))\n\n;(defonce histology-cursor (rum/cursor rtdb :histology))\n;(defonce plot-style-cursor (rum/cursor rtdb :plot-style))\n\n(defonce hide-warning-cursor (rum/cursor rtdb :hide-warning))\n(defonce hide-warning-change (make-topic :hide-warning-change))\n\n(defonce show-uncertainty-cursor (rum/cursor rtdb :show-uncertainty))\n(defonce show-uncertainty-change (make-topic :show-uncertainty-change))\n\n(defonce route (rum/cursor rtdb :route))\n(defonce route-change (make-topic :route-change))\n\n(defonce help-header-cursor (rum/cursor rtdb :help-header))\n(defonce help-header-change (make-topic :help-header-change))\n\n(defonce help-content-cursor (rum/cursor rtdb :help-content))\n(defonce help-content-change (make-topic :help-content-change))\n\n(defonce help-key-cursor (rum/cursor rtdb :help-key))\n(defonce help-key-change (make-topic :help-key-change))\n\n(defonce settings-cursor (rum/cursor rtdb :settings-visible))\n(defonce settings-change (make-topic :settings-change))\n\n(defonce print-cursor (rum/cursor rtdb :print-visible))\n(defonce print-change (make-topic :print-change))\n\n(defonce help-cursor (rum/cursor rtdb :settings-visible))\n(defonce help-change (make-topic :settings-change))\n\n;; input keys that are currently on-screen\n(defonce on-screen-inputs-cursor (rum/cursor rtdb :on-screen-inputs))\n\n;; ref to a set containing active treatment keys (like :hormone)\n(defonce on-screen-treatments-cursor (rum/cursor rtdb :on-screen-treatments))\n\n; for REPL use\n(def ost on-screen-treatments-cursor)\n\n(defonce results-change (make-topic :results))\n(defonce results-cursor (rum/cursor rtdb :results))\n\n\n#_(defonce treatment-selection-cursor (rum/derived-atom [treatments-visible-cursor results-cursor] ::treatment-selection\n                                                        (fn [a b] (and a b))))\n\n(defonce active-results-pane (rum/cursor rtdb :active-results-pane))\n(defonce active-results-change (make-topic :active-results-pane))\n\n(defonce mockup-cursor (rum/cursor rtdb :active-mockup))\n(defonce mockup-change (make-topic :active-mockup))\n\n(defonce force-recalculation (make-topic :force-recalculation))\n\n\n;;;\n;; Input keys\n;;;\n(defn input-cursors []\n  (get-in @rtdb [:input-config :cursor]))\n\n;; and define an access function ...for cursors\n(defn input-cursor [key]\n  (get-in @rtdb [:input-config :cursor key]))\n\n;; ...and for mutators\n(defn input-changes []\n  (get-in @rtdb [:input-config :change]))\n\n(defn input-change [key]\n  (get-in @rtdb [:input-config :change key]))\n\n(defn input-label [key]\n  (get-in @rtdb [:input-config :label key]))\n\n(defn input-default [key]\n  (get-in @rtdb [:input-config :default key]))\n\n(defn input-widget [key]\n  (get-in @rtdb [:input-config :widget key]))\n\n(defn input-access [key]\n  (get-in @rtdb [:input-config :access key]))\n\n(defn input-map\n  \"This is the map of values that we feed into the model.\n  Keys are unqualified (i.e. they don't refer to the selected treatment option).\"\n  []\n  (into {}\n        (map (fn [[k v]] [k @v])\n             (filter (fn [[k _]]\n                       ((union @on-screen-inputs-cursor @on-screen-treatments-cursor) k)) (input-cursors)))))\n\n\n(defn year-selected []\n  \"return a cursor containing the selected year\"\n  (input-cursor :result-year))\n\n\n(defn error? [v]\n  (or (nil? v) (= v \"\") (and (string? v) (some? (index-of v \":\")))))\n\n(defn error-by-key? [k]\n  (error? @(input-cursor k)))\n\n\n(defn recalculate-model?\n  \"return true if the model can be calculated, else nil.\n  im is the result of calling input-map\"\n  [input-map]\n  (and (seq @on-screen-inputs-cursor)\n       (every? (fn [k] (and (input-map k) (not (error-by-key? k)))) @on-screen-inputs-cursor))\n  )\n\n\n;;;\n;; Treatment keys - which depend on input keys\n;;;\n(comment                                                    ;; -- tests\n\n\n  (input-cursors)\n  ; A map of all possible input cursors installed in input-config\n\n  (input-changes)\n  ; A map of input mutation channels. Each one references a publication topic.\n\n  @on-screen-inputs-cursor\n  ; inputs which appear on screen\n  ; #{:age :size :her2-status :mode :ki67-status :nodes :grade :er-status :micromets}\n\n  @on-screen-treatments-cursor\n  ; A set! (It could be ordered to save n needing graphable-treatment)\n  ; => #{:chemo :horm :tra}\n\n  (input-map)\n  ; This is the map of values that we feed into the model.\n  ; Keys are unqualified (i.e. they don't refer to the selected treatment option)\n  ; Values are however sensitive to the treatment option setting.\n  ;=> {:tra nil, :age 40, :size 2, :her2-status :yes, :mode :symptomatic, :ki67-status :yes, :nodes 2, :grade 2, :horm nil, :er-status :yes, :chemo nil, :micromets :no}\n\n  ;; show all inputs\n  (into {} (map (fn [[k v]] [k @v]) (input-cursors)))\n  ; => {:post-meno nil, :chemo nil, :tra nil, :age 40, :opt-picker-1 nil, :tra nil, :size 2, :performance nil, :radio nil, :horm nil, :her2-status :yes, :tra nil, :pr-status nil, :mode :symptomatic, :opt-picker-0 nil, :tra nil, :heart-dose nil, :type nil, :ethnicity nil, :radio nil, :ki67-status :yes, :size nil, :oncotype nil, :surgery nil, :chemo nil, :lung-dose nil, :nodes 2, :bis nil, :grade 2, :weight nil, :bmi nil, :bis nil, :heart-dose nil, :horm nil, :horm nil, :side nil, :chemo nil, :er-status :yes, :chemo nil, :micromets :no, :lung-dose nil, :smoking nil, :horm nil,:height nil, :neo :no}\n\n\n  @results-cursor\n  ;; ([5 {:bcSpecSur 0.9769091120924175, :cumOverallSurOL 0.9692325692973538, :cumOverallSurHormo 0.007321510374584478, :cumOverallSurChemo 0, :cumOverallSurCandH 0.007321510374584478, :cumOverallSurCHT 0.012019282569459833}] [10 {:bcSpecSur 0.9407891636797882, :cumOverallSurOL 0.9192541233440501, :cumOverallSurHormo 0.018478310249836996, :cumOverallSurChemo 0, :cumOverallSurCandH 0.018478310249836996, :cumOverallSurCHT 0.030465967535812846}] [20 {:bcSpecSur 0.8760500103304053, :cumOverallSurOL 0.8104345849686604, :cumOverallSurHormo 0.037282221638997734, :cumOverallSurChemo 0, :cumOverallSurCandH 0.037282221638997734, :cumOverallSurCHT 0.0620689089391925}])\n\n  )"]}