{"version":3,"sources":["predict_prostate/results/util.cljs"],"mappings":"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","names":["predict-prostate.results.util/encode-triplet","e1","e2","e3","keys","cljs.core.into","enc1","enc2","enc3","enc4","clojure.string.join","predict-prostate.results.util/encode-rgb","r","g","b","predict-prostate.results.util/generate-pixel","encoded-color","predict-prostate.results.util/fill-data-url","predict-prostate.results.util/hex-data-url","hex","cljs.core.apply","goog.color/hexToRgb","predict-prostate.results.util/dashed-stroke","predict-prostate.results.util/above-dashed","predict-prostate.results.util/conservative-fill","predict-prostate.results.util/radical-fill","predict-prostate.results.util/radical-range","predict-prostate.results.util/radical-below","predict-prostate.results.util/radical-above","predict-prostate.results.util/fills-by-style","predict-prostate.results.util/fills-by-style*","predict-prostate.results.util/fills","predict-prostate.results.util/fill","predict-prostate.results.util/data-fill","index","predict-prostate.results.util/min-label-percent","predict-prostate.results.util/treatment-fills","G__46176","cljs.core/count","predict-prostate.results.util/treatment-fills*","plot-style","f","G__46177","p__46178","map__46179","cljs.core/--destructure-map","cljs.core.get","predict-prostate.results.util/clip","value","min","max","var_args","args__4824__auto__","len__4818__auto__","i__4819__auto__","argseq__4825__auto__","cljs.core/IndexedSeq","predict-prostate.results.util/toPrecision","p__46182","vec__46183","cljs.core.nth","seq46180","G__46181","cljs.core/first","cljs.core/next","self__4805__auto__","high","js/parseFloat","js/Number","predict-prostate.results.util/avoid-decimals","p__46190","vec__46191","seq46186","G__46187","d","p","predict-prostate.results.util/one-dp","predict-prostate.results.util/to-percent","G__46200","predict-prostate.results.util/percent","js/Error","Math/round","predict-prostate.results.util/prostate-blue","predict-prostate.results.util/NHS-blue","predict-prostate.results.util/alison-blue-1","predict-prostate.results.util/alison-blue-1-rgb","predict-prostate.results.util/alison-blue-2","predict-prostate.results.util/alison-blue-3","predict-prostate.results.util/alison-blue-5","predict-prostate.results.util/alison-blue-4","predict-prostate.results.util/alison-pink"],"sourcesContent":["(ns predict-prostate.results.util\n  (:require [clojure.string :refer [join]]\n            [goog.color :as col :refer [parse lighten rgbToHex hexToRgb rgbArrayToHex blend]]))\n\n;;;\n;; Most browsers do not print background colours without the user setting a preference to do so.\n;; We can paint divs with a background image, but we need to generate them algorithimcally.\n;; Let's have a go at making dataURLs to paint backgrounds...\n;;\n;; See http://jsfiddle.net/LPxrT/\n;;\n(defn encode-triplet [e1 e2 e3]\n  (let [keys (into [] \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\")\n        enc1 (bit-shift-right e1 2)\n        enc2 (bit-or (bit-shift-left (bit-and e1 3) 4) (bit-shift-right e2 4))\n        enc3 (bit-or (bit-shift-left (bit-and e2 15) 2) (bit-shift-right e3 6))\n        enc4 (bit-and e3 63)]\n    (join [(keys enc1) (keys enc2) (keys enc3) (keys enc4)])))\n\n(defn encode-rgb [r g b]\n  (join [(encode-triplet 0 r g) (encode-triplet b 255 255)]))\n\n(defn generate-pixel [encoded-color]\n  (join [\"data:image/gif;base64,R0lGODlhAQABAPAA\" encoded-color \"/yH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==\"]))\n\n(defn fill-data-url\n  \"Generates a 1 px data url from an rgb colour\"\n  [r g b]\n  (generate-pixel (encode-rgb r g b)))\n\n(defn hex-data-url\n  \"Generates a 1 px data url from a hex colour\"\n  [hex]\n  (apply fill-data-url (hexToRgb hex)))\n\n(def dashed-stroke \"#FA0\")\n\n;;\n;; Colour scale designed in chroma.js, then heavily modified!\n;;\n(def above-dashed \"#ffffff\")\n#_(def conservative-fill \"#0000aa\")\n(def conservative-fill \"#2222dd\")\n(def radical-fill \"#00afef\")\n(def radical-range \"#88ddff\")\n(def radical-below \"#00ddff\")\n(def radical-above \"#eeee88\" #_\"#beebff\")\n\n(def fills-by-style\n  {:area1 [above-dashed\n           radical-fill\n           conservative-fill]\n   :line2 [above-dashed\n           radical-above\n           radical-below\n           conservative-fill]})\n\n(def fills-by-style*\n  {:area1 {:above above-dashed\n           :radical-above above-dashed\n           :radical radical-fill\n           :conservative conservative-fill}\n   :line2 {:above above-dashed\n           :radical-above radical-above\n           :radical radical-below\n           :conservative conservative-fill}})\n\n(def fills [\"#ffffff\"\n            \"#00afef\"\n            conservative-fill])\n\n(comment\n  (def f1 #js [136 221 255])                                ;\"#88ddff\"\n  (def f2 #js [190 235 255])                                ;\"#beebff\"\n  (apply rgbToHex f1)\n  (apply rgbToHex f2)\n  )\n\n(def fill fills)\n\n(defn data-fill [index]\n  \"Generates a 1 pixel data-url from a fill index\"\n  (apply fill-data-url (hexToRgb (fill index))))\n\n\n; The minimum bar size before a bar label shows up\n(def min-label-percent 3)\n\n\n(defn treatment-fills [index]\n  \"reverse order of fills for treatment plot\"\n  (fill (- (dec (count fills)) index))\n  )\n\n(defn treatment-fills* [plot-style index]\n  \"reverse order of fills for treatment plot\"\n  (let [f (plot-style fills-by-style)]\n    (f (- (dec (count f)) index)))\n  )\n\n(comment\n  \"these urls should display in browsers as the basic stepped colours\"\n  (data-fill 0)\n  ; => \"data:image/gif;base64,R0lGODlhAQABAPAAAHG03P///yH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==\"\n\n  (data-fill 1)\n  ; => \"data:image/gif;base64,R0lGODlhAQABAPAAAGaMwv///yH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==\"\n\n  (data-fill 2)\n  ; => \"data:image/gif;base64,R0lGODlhAQABAPAAAAAAqv///yH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==\"\n\n  (encode-triplet 0 0 0)\n  ;=> \"AAAA\"\n\n  (encode-triplet 255 128 1)\n  ;=> \"/4AB\"\n\n  (lighten (hexToRgb \"#DD8800\") 0.5)\n  (rgbToHex (lighten (hexToRgb \"#DD8800\") 0.5))\n  (rgbToHex #js [238 196 128])\n\n  (fill 0)                                                  ;=> light-fill\n  (fill 1)\n  (fill 2)\n  (fill 3)\n  )\n\n\n;;\n;; models may recalculate data based on what is required for the currently selected presentation\n;;\n\n(defn clip [{:keys [value min max]\n             :or   {value 0 min 0 max 10}}]\n  \"clip a value to be between min and max inclusively\"\n  (if (> value max)\n    max\n    (if (< value min)\n      min\n      value)))\n\n(defn toPrecision\n  [f & [high]]\n  (js/parseFloat (.toPrecision (js/Number. f) (if (>= f 10) 2 (if high 2 1)))))\n\n\n(defn avoid-decimals [d & [high]]\n  \"return a string representation of a number such as a percentage.\"\n  (let [p (if (< d 10) (if high 1 0) 0)]\n    (.toFixed (js/Number. d) p)))\n\n(defn one-dp [d p]\n  \"return a string representation of a number such as a percentage.\"\n  (.toFixed (js/Number. d) p))\n\n(defn to-percent\n  \"convert float fraction to a decimal percent value at full precision\"\n  [f]\n  (* 100 f))\n\n(defn percent\n  ([d]\n   (str (Math/round (* 100 d)) \"%\")\n    #_(percent d 0))\n  ([d p]\n   (str (one-dp (* 100 d) p) \"%\")))\n\n;; (comment\n;;   (to-percent 0.0032 false)                                 ;=> 0.3\n;;   (to-percent 0.0032 true)                                  ;=> 0.32\n;;   (to-percent 0.0032)                                       ;=> 0.3\n;;   (to-percent 0.2345 true)\n;;   (to-percent 0.002345)\n;;   )\n\n;;;\n;; Alison styling\n;;;\n;;;\n;; Some colours\n(def prostate-blue \"#225FB1\")\n(def NHS-blue \"#005EB4\")\n(def alison-blue-1 \"#d3e7fd\")                               ; home page block\n(def alison-blue-1-rgb [211 231 253])                       ; home page block\n(def alison-blue-2 \"#002e5d\")                               ; navbar & footer\n(def alison-blue-3 \"#1f6bc4\")                               ; h1,h2.., primary button\n(def alison-blue-5 \"#edf5ff\")                               ; treatment options results background\n(def alison-blue-4 \"#ffffff\")                               ; treatment options results background (reverted)\n(def alison-pink \"#b4078d\")                               ; treatment options results background (reverted)\n\n\n\n"]}