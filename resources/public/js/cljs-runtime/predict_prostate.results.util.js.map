{"version":3,"sources":["predict_prostate/results/util.cljs"],"mappings":"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","names":["predict-prostate.results.util/encode-triplet","e1","e2","e3","keys","cljs.core.into","enc1","enc2","enc3","enc4","clojure.string.join","predict-prostate.results.util/encode-rgb","r","g","b","predict-prostate.results.util/generate-pixel","encoded-color","predict-prostate.results.util/fill-data-url","predict-prostate.results.util/hex-data-url","hex","cljs.core.apply","goog.color/hexToRgb","predict-prostate.results.util/dashed-stroke","predict-prostate.results.util/above-dashed","predict-prostate.results.util/conservative-fill","predict-prostate.results.util/radical-fill","predict-prostate.results.util/radical-range","predict-prostate.results.util/radical-below","predict-prostate.results.util/radical-above","predict-prostate.results.util/fills-by-style","predict-prostate.results.util/fills-by-style*","predict-prostate.results.util/fills","predict-prostate.results.util/fill","predict-prostate.results.util/data-fill","index","predict-prostate.results.util/min-label-percent","predict-prostate.results.util/treatment-fills","G__32730","cljs.core/count","predict-prostate.results.util/treatment-fills*","plot-style","f","G__32734","p__32738","map__32739","cljs.core/PROTOCOL_SENTINEL","cljs.core/hash-map","cljs.core.get","predict-prostate.results.util/clip","value","min","max","var_args","args__4742__auto__","len__4736__auto__","i__4737__auto__","argseq__4743__auto__","cljs.core/IndexedSeq","predict-prostate.results.util/toPrecision","p__32794","vec__32814","cljs.core.nth","seq32743","G__32753","cljs.core/first","cljs.core/next","self__4723__auto__","high","js/parseFloat","js/Number","predict-prostate.results.util/avoid-decimals","p__32837","vec__32838","seq32826","G__32827","d","p","predict-prostate.results.util/one-dp","predict-prostate.results.util/to-percent","G__32883","predict-prostate.results.util/percent","js/Error","Math/round","predict-prostate.results.util/prostate-blue","predict-prostate.results.util/NHS-blue","predict-prostate.results.util/alison-blue-1","predict-prostate.results.util/alison-blue-1-rgb","predict-prostate.results.util/alison-blue-2","predict-prostate.results.util/alison-blue-3","predict-prostate.results.util/alison-blue-5","predict-prostate.results.util/alison-blue-4","predict-prostate.results.util/alison-pink"],"sourcesContent":["(ns predict-prostate.results.util\n  (:require [clojure.string :refer [join]]\n            [goog.color :as col :refer [parse lighten rgbToHex hexToRgb rgbArrayToHex blend]]))\n\n;;;\n;; Most browsers do not print background colours without the user setting a preference to do so.\n;; We can paint divs with a background image, but we need to generate them algorithimcally.\n;; Let's have a go at making dataURLs to paint backgrounds...\n;;\n;; See http://jsfiddle.net/LPxrT/\n;;\n(defn encode-triplet [e1 e2 e3]\n  (let [keys (into [] \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\")\n        enc1 (bit-shift-right e1 2)\n        enc2 (bit-or (bit-shift-left (bit-and e1 3) 4) (bit-shift-right e2 4))\n        enc3 (bit-or (bit-shift-left (bit-and e2 15) 2) (bit-shift-right e3 6))\n        enc4 (bit-and e3 63)]\n    (join [(keys enc1) (keys enc2) (keys enc3) (keys enc4)])))\n\n(defn encode-rgb [r g b]\n  (join [(encode-triplet 0 r g) (encode-triplet b 255 255)]))\n\n(defn generate-pixel [encoded-color]\n  (join [\"data:image/gif;base64,R0lGODlhAQABAPAA\" encoded-color \"/yH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==\"]))\n\n(defn fill-data-url\n  \"Generates a 1 px data url from an rgb colour\"\n  [r g b]\n  (generate-pixel (encode-rgb r g b)))\n\n(defn hex-data-url\n  \"Generates a 1 px data url from a hex colour\"\n  [hex]\n  (apply fill-data-url (hexToRgb hex)))\n\n(def dashed-stroke \"#FA0\")\n\n;;\n;; Colour scale designed in chroma.js, then heavily modified!\n;;\n(def above-dashed \"#ffffff\")\n#_(def conservative-fill \"#0000aa\")\n(def conservative-fill \"#2222dd\")\n(def radical-fill \"#00afef\")\n(def radical-range \"#88ddff\")\n(def radical-below \"#00ddff\")\n(def radical-above \"#eeee88\" #_\"#beebff\")\n\n(def fills-by-style\n  {:area1 [above-dashed\n           radical-fill\n           conservative-fill]\n   :line2 [above-dashed\n           radical-above\n           radical-below\n           conservative-fill]})\n\n(def fills-by-style*\n  {:area1 {:above above-dashed\n           :radical-above above-dashed\n           :radical radical-fill\n           :conservative conservative-fill}\n   :line2 {:above above-dashed\n           :radical-above radical-above\n           :radical radical-below\n           :conservative conservative-fill}})\n\n(def fills [\"#ffffff\"\n            \"#00afef\"\n            conservative-fill])\n\n(comment\n  (def f1 #js [136 221 255])                                ;\"#88ddff\"\n  (def f2 #js [190 235 255])                                ;\"#beebff\"\n  (apply rgbToHex f1)\n  (apply rgbToHex f2)\n  )\n\n(def fill fills)\n\n(defn data-fill [index]\n  \"Generates a 1 pixel data-url from a fill index\"\n  (apply fill-data-url (hexToRgb (fill index))))\n\n\n; The minimum bar size before a bar label shows up\n(def min-label-percent 3)\n\n\n(defn treatment-fills [index]\n  \"reverse order of fills for treatment plot\"\n  (fill (- (dec (count fills)) index))\n  )\n\n(defn treatment-fills* [plot-style index]\n  \"reverse order of fills for treatment plot\"\n  (let [f (plot-style fills-by-style)]\n    (f (- (dec (count f)) index)))\n  )\n\n(comment\n  \"these urls should display in browsers as the basic stepped colours\"\n  (data-fill 0)\n  ; => \"data:image/gif;base64,R0lGODlhAQABAPAAAHG03P///yH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==\"\n\n  (data-fill 1)\n  ; => \"data:image/gif;base64,R0lGODlhAQABAPAAAGaMwv///yH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==\"\n\n  (data-fill 2)\n  ; => \"data:image/gif;base64,R0lGODlhAQABAPAAAAAAqv///yH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==\"\n\n  (encode-triplet 0 0 0)\n  ;=> \"AAAA\"\n\n  (encode-triplet 255 128 1)\n  ;=> \"/4AB\"\n\n  (lighten (hexToRgb \"#DD8800\") 0.5)\n  (rgbToHex (lighten (hexToRgb \"#DD8800\") 0.5))\n  (rgbToHex #js [238 196 128])\n\n  (fill 0)                                                  ;=> light-fill\n  (fill 1)\n  (fill 2)\n  (fill 3)\n  )\n\n\n;;\n;; models may recalculate data based on what is required for the currently selected presentation\n;;\n\n(defn clip [{:keys [value min max]\n             :or   {value 0 min 0 max 10}}]\n  \"clip a value to be between min and max inclusively\"\n  (if (> value max)\n    max\n    (if (< value min)\n      min\n      value)))\n\n(defn toPrecision\n  [f & [high]]\n  (js/parseFloat (.toPrecision (js/Number. f) (if (>= f 10) 2 (if high 2 1)))))\n\n\n(defn avoid-decimals [d & [high]]\n  \"return a string representation of a number such as a percentage.\"\n  (let [p (if (< d 10) (if high 1 0) 0)]\n    (.toFixed (js/Number. d) p)))\n\n(defn one-dp [d p]\n  \"return a string representation of a number such as a percentage.\"\n  (.toFixed (js/Number. d) p))\n\n(defn to-percent\n  \"convert float fraction to a decimal percent value at full precision\"\n  [f]\n  (* 100 f))\n\n(defn percent\n  ([d]\n   (str (Math/round (* 100 d)) \"%\")\n    #_(percent d 0))\n  ([d p]\n   (str (one-dp (* 100 d) p) \"%\")))\n\n;; (comment\n;;   (to-percent 0.0032 false)                                 ;=> 0.3\n;;   (to-percent 0.0032 true)                                  ;=> 0.32\n;;   (to-percent 0.0032)                                       ;=> 0.3\n;;   (to-percent 0.2345 true)\n;;   (to-percent 0.002345)\n;;   )\n\n;;;\n;; Alison styling\n;;;\n;;;\n;; Some colours\n(def prostate-blue \"#225FB1\")\n(def NHS-blue \"#005EB4\")\n(def alison-blue-1 \"#d3e7fd\")                               ; home page block\n(def alison-blue-1-rgb [211 231 253])                       ; home page block\n(def alison-blue-2 \"#002e5d\")                               ; navbar & footer\n(def alison-blue-3 \"#1f6bc4\")                               ; h1,h2.., primary button\n(def alison-blue-5 \"#edf5ff\")                               ; treatment options results background\n(def alison-blue-4 \"#ffffff\")                               ; treatment options results background (reverted)\n(def alison-pink \"#b4078d\")                               ; treatment options results background (reverted)\n\n\n\n"]}