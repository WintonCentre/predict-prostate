{"version":3,"sources":["rum/derived_atom.cljc"],"mappings":"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","names":["var_args","G__30159","rum.derived-atom/derived-atom","js/Error","refs","key","f","rum.derived_atom.derived_atom","opts","map__30164","cljs.core/--destructure-map","cljs.core.get","ref","check-equals?","recalc","G__30165","cljs.core/count","vec__30166","cljs.core.nth","a","G__30169","cljs.core/deref","vec__30173","b","G__30176","G__30177","vec__30178","c","G__30181","G__30182","G__30183","cljs.core.apply","cljs.core.map","sink","G__30184","cljs.core/reset!","cljs.core.atom","watch","_","new-val","cljs.core.not_EQ_","seq__30186","cljs.core/seq","chunk__30187","count__30188","i__30189","temp__5753__auto__","cljs.core/chunked-seq?","c__4638__auto__","cljs.core/chunk-first","cljs.core/chunk-rest","cljs.core/first","cljs.core/next","cljs.core/add-watch"],"sourcesContent":["(ns ^:no-doc rum.derived-atom)\n\n(defn derived-atom\n  ([refs key f]\n   (derived-atom refs key f {}))\n  ([refs key f opts]\n   (let [{:keys [ref check-equals?]\n          :or {check-equals? true}} opts\n         recalc (case (count refs)\n                  1 (let [[a] refs] #(f @a))\n                  2 (let [[a b] refs] #(f @a @b))\n                  3 (let [[a b c] refs] #(f @a @b @c))\n                  #(apply f (map deref refs)))\n         sink   (if ref\n                  (doto ref (reset! (recalc)))\n                  (atom (recalc)))\n         watch  (if check-equals?\n                  (fn [_ _ _ _]\n                    (let [new-val (recalc)]\n                      (when (not= @sink new-val)\n                        (reset! sink new-val))))\n                  (fn [_ _ _ _]\n                    (reset! sink (recalc))))]\n     (doseq [ref refs]\n       (add-watch ref key watch))\n     sink)))\n"]}