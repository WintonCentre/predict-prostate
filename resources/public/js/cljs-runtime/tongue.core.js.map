{"version":3,"sources":["tongue/core.cljc"],"mappings":"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","names":["tongue.core/inst-formatter","tongue.inst/formatter","tongue.core/format-inst-iso","G__42453","G__42454","tongue.core/number-formatter","tongue.number/formatter","tongue.core/parse-long","s","js/parseInt","js/tongue","js/tongue.core","js/tongue.core.tags-cache","tongue.core/tags-cache","cljs.core/volatile!","tongue.core/tags","locale","or__4212__auto__","fexpr__42456","cljs.core/deref","tags","subtags","clojure.string.split","cljs.core/name","last-tag","temp__5755__auto__","subtag","cljs.core/first","tag","cljs.core/next","cljs.core.conj","cljs.core.keyword","cljs.core.assoc","tongue.core/lookup-template-for-locale","dicts","key","temp__5757__auto__","dict","cljs.core.get","cljs.core/contains?","cljs.core/reduced","tongue.core/lookup-template","tongue.core/escape-re-subst","str","clojure.string/replace","tongue.core/format-argument","x","formatter","cljs.core/unreduced","cljs.core/str","cljs.core/inst?","tongue$core$IInterpolate$interpolate_named$dyn","x__4509__auto__","m__4510__auto__","tongue.core/interpolate-named","goog/typeOf","m__4508__auto__","cljs.core/missing-protocol","tongue$core$IInterpolate$interpolate_positional$dyn","tongue.core/interpolate-positional","tongue.core/IInterpolate","v","interpolations","goog.object/set","p__42539","vec__42540","cljs.core.nth","_","k","p__42543","vec__42544","n","idx","arg","tongue.core/invoke?","t","cljs.core/ifn?","cljs.core/PROTOCOL_SENTINEL","cljs.core/native-satisfies?","tongue.core/translate-missing","var_args","G__42573","tongue.core/translate","args-arr__4839__auto__","len__4818__auto__","i__4819__auto__","argseq__4840__auto__","cljs.core/IndexedSeq","seq42565","G__42566","G__42567","G__42568","G__42569","self__4805__auto__","cljs.core/map?","rest","args","cljs.core/cons","cljs.core.apply","tongue.core/append-ns","ns","segment","G__42587","tongue.core/build-dict","js/Error","tongue.core.build_dict","cljs.core/reduce-kv","aggr","value","cljs.core._EQ_","cljs.core/namespace","cljs.core.merge","tongue.core/resolve-alias-1","m","path","cljs.core.ex_info","val","tongue.core/resolve-aliases","cljs.core.into","p1__42593#","cljs.core.map","cljs.core/PersistentVector","cljs.core/second","tongue.core/build-dicts","acc","lang","tongue.core/build-translate","compiled-dicts","tongue.core.translate"],"sourcesContent":["(ns tongue.core\n  (:require\n    [clojure.string :as str]\n    [tongue.inst :as inst]\n    [tongue.number :as number]\n    [tongue.macro :as macro]\n    #?(:clj [clojure.future :refer :all])\n    #?(:clj [clojure.spec.alpha :as spec])))\n\n\n(def inst-formatter inst/formatter)\n\n\n(def format-inst-iso (inst-formatter \"{year}-{month-numeric-padded}-{day-padded}T{hour24-padded}:{minutes-padded}:{seconds-padded}\" {}))\n\n\n(def number-formatter number/formatter)\n\n\n(defn- parse-long [s]\n  #?(:cljs (js/parseInt s)\n     :clj  (Long/parseLong s)))\n\n\n(defonce ^:private tags-cache (volatile! {}))\n\n\n(defn- tags\n  \":az-Arab-IR => (:az-Arab-IR :az-Arab :az), cached\"\n  [locale]\n  (or (@tags-cache locale)\n      (let [tags (loop [subtags  (str/split (name locale) #\"-\")\n                        last-tag nil\n                        tags     ()]\n                   (if-some [subtag (first subtags)]\n                     (let [tag (str last-tag (when last-tag \"-\") subtag)]\n                       (recur (next subtags) tag (conj tags (keyword tag))))\n                     tags))]\n        (vswap! tags-cache assoc locale tags)\n        tags)))\n\n\n(defn- lookup-template-for-locale [dicts locale key]\n  (when locale\n    (loop [tags (tags locale)]\n      (when-some [tag (first tags)]\n        (or\n          (let [dict (get dicts tag)]\n            (when (contains? dict key)\n              (reduced (get dict key))))\n          (recur (next tags)))))))\n\n\n(defn- lookup-template [dicts locale key]\n  (or\n    (lookup-template-for-locale dicts locale key)\n    (lookup-template-for-locale dicts (:tongue/fallback dicts) key)))\n\n\n(defn- escape-re-subst [str]\n  #?(:clj (java.util.regex.Matcher/quoteReplacement str)\n     :cljs (str/replace str #\"\\$\" \"$$$$\")))\n\n\n(defn format-argument [dicts locale x]\n  (cond\n    (number? x)\n    (let [formatter (unreduced\n                      (or (lookup-template-for-locale dicts locale :tongue/format-number)\n                        str))]\n                  (formatter x))\n\n    (inst? x)\n    (let [formatter (unreduced\n                      (or (lookup-template-for-locale dicts locale :tongue/format-inst)\n                        format-inst-iso))]\n      (formatter x))\n\n    :else\n    (str x)))\n\n\n(defprotocol IInterpolate\n  (interpolate-named [v dicts locale interpolations]\n    \"Interpolate the value `v` with named `interpolations` in the provided map.\")\n\n  (interpolate-positional [v dicts locale interpolations]\n    \"Interpolate the value `v` with positional `interpolations` in the provided vector.\"))\n\n\n(extend-type #?(:clj String\n                :cljs string)\n  IInterpolate\n  (interpolate-named [s dicts locale interpolations]\n    (str/replace s #?(:clj  #\"\\{([\\w*!_?$%&=<>'\\-+.#0-9]+|[\\w*!_?$%&=<>'\\-+.#0-9]+\\/[\\w*!_?$%&=<>'\\-+.#0-9:]+)\\}\"\n                      :cljs #\"\\{([\\w*!_?$%&=<>'\\-+.#0-9]+|[\\w*!_?$%&=<>'\\-+.#0-9]+/[\\w*!_?$%&=<>'\\-+.#0-9:]+)\\}\")\n                 (fn [[_ k]]\n                   (format-argument dicts locale (get interpolations (keyword k))))))\n\n  (interpolate-positional [s dicts locale interpolations]\n    (str/replace s #\"\\{(\\d+)\\}\"\n                 (fn [[_ n]]\n                   (let [idx (parse-long n)\n                         arg (nth interpolations (dec idx)\n                                  (str \"{Missing index \" idx \"}\"))]\n                     (format-argument dicts locale arg))))))\n\n\n(macro/with-spec\n  (spec/def ::locale simple-keyword?)\n  (spec/def ::key keyword?))\n\n\n(defn- invoke? [t]\n  (and (ifn? t) (not (satisfies? IInterpolate t))))\n\n\n(defn- translate-missing [dicts locale key]\n  (macro/if-some-reduced [t (lookup-template dicts locale :tongue/missing-key)]\n    (cond\n      (invoke? t) (interpolate-positional (t key) dicts locale [key])\n      (nil? t)    nil\n      :else       (interpolate-positional t dicts locale [key]))\n    (str \"{Missing key \" key \"}\")))\n\n\n(defn- translate\n  ([dicts locale key]\n   (macro/with-spec\n     (spec/assert ::locale locale)\n     (spec/assert ::key key))\n   (macro/if-some-reduced [t (lookup-template dicts locale key)]\n     (if (invoke? t) (t) t)\n     (translate-missing dicts locale key)))\n  ([dicts locale key x]\n   (macro/with-spec\n     (spec/assert ::locale locale)\n     (spec/assert ::key key))\n   (macro/if-some-reduced [t (lookup-template dicts locale key)]\n     (let [v (if (invoke? t) (t x) t)]\n       (if (map? x)\n         (interpolate-named v dicts locale x)\n         (interpolate-positional v dicts locale [x])))\n     (translate-missing dicts locale key)))\n  ([dicts locale key x & rest]\n   (macro/with-spec\n     (spec/assert ::locale locale)\n     (spec/assert ::key key))\n   (macro/if-some-reduced [t (lookup-template dicts locale key)]\n     (let [args (cons x rest)]\n       (interpolate-positional (if (invoke? t) (apply t x rest) t) dicts locale args))\n     (translate-missing dicts locale key))))\n\n\n(defn- append-ns [ns segment]\n  (str (when ns (str ns \".\"))\n       segment))\n\n\n(defn- build-dict\n  \"Collapses nested maps into namespaced keywords:\n   { :ns { :key 1 }} => { :ns/key 1 }\n   { :animal { :flying { :bird 420 }}} => { :animal.flying/bird 420 }\"\n  ([dict] (build-dict nil dict))\n  ([ns dict]\n    (reduce-kv\n      (fn [aggr key value]\n        (cond\n          (= \"tongue\" (namespace key))\n          (do\n            (assert (nil? ns) \":tongue/... keys can only be specified at top level\")\n            (assoc aggr key value))\n\n          (map? value)\n          (merge aggr (build-dict (append-ns ns (name key)) value))\n\n          :else\n          (assoc aggr (keyword (or ns (namespace key)) (name key)) value)))\n      {} dict)))\n\n\n(defn- resolve-alias-1\n  [m k]\n  (loop [v k\n         path #{}]\n    (when (path v)\n      (throw (ex-info \"Unable to resolve mutually recursive alias\" {:keys path})))\n    (let [val (or (m v) v)]\n      (if (= val v)\n        val\n        (recur val (conj path v))))))\n\n\n(defn- resolve-aliases\n  \"Shallowly walks a map, and finds every value that is also a key in the same\n  map, and replaces the value with the referenced value. Recursively walks the\n  map to resolve layered aliases.\n\n  (resolve-aliases {:a 1 :b 2 :c :a}) ;;=> {:a 1 :b 2 :c 1}\"\n  [m]\n  (into {} (map #(vector (first %) (resolve-alias-1 m (second %))) m)))\n\n\n(defn build-dicts [dicts]\n  (reduce-kv\n    (fn [acc lang dict]\n      (assoc acc lang (if (map? dict) (-> dict build-dict resolve-aliases) dict)))\n    {} dicts))\n\n\n(macro/with-spec\n  (spec/def ::template (spec/or\n                         :str string?\n                         :fn  ifn?\n                         :nil nil?))\n\n  (spec/def :tongue/format-number ifn?)\n  (spec/def :tongue/format-inst ifn?)\n  (spec/def :tongue/missing-key ::template)\n\n  (spec/def ::dict (spec/and\n                     (spec/keys :opt [:tongue/format-number :tongue/format-inst :tongue/missing-key])\n                     (spec/map-of keyword? (spec/or :plain  ::template\n                                                    :nested (spec/map-of keyword? ::template)))))\n\n  (spec/def :tongue/fallback keyword?)\n  (spec/def ::dicts (spec/and\n                      (spec/keys :opt [:tongue/fallback])\n                      (spec/conformer #(dissoc % :tongue/fallback))\n                      (spec/map-of keyword? ::dict))))\n\n\n(defn build-translate\n  \"Given dicts, builds translate function closed over these dicts:\n\n       (build-translate dicts) => ( [locale key & args] => string )\"\n  [dicts]\n  (macro/with-spec\n    (spec/assert ::dicts dicts))\n  (let [compiled-dicts (build-dicts dicts)]\n    (fn\n      ([locale key]   (translate compiled-dicts locale key))\n      ([locale key x] (translate compiled-dicts locale key x))\n      ([locale key x & args]\n        (apply translate compiled-dicts locale key x args)))))\n"]}