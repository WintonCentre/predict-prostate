{"version":3,"sources":["predict_prostate/mixins.cljs"],"mappings":"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","names":["var_args","G__76210","predict-prostate.mixins/arg-local","js/Error","initial","predict_prostate.mixins.arg_local","key","p__76232","map__76233","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply","cljs.core/hash-map","cljs.core.get","args","state","cljs.core.assoc","cljs.core.atom","cljs.core/fn?","predict-prostate.mixins/sizing-mixin","node","js/ReactDOM.findDOMNode","resize","cljs.core/reset!","js/window","predict-prostate.mixins/active-monitor","vec__76288","map__76291","cljs.core.nth","cljs.core.swap_BANG_","predict-prostate.state.run-time/on-screen-inputs-cursor","cljs.core/conj","predict-prostate.state.run-time/force-recalculation","vec__76311","map__76314","cljs.core/disj","predict-prostate.mixins/treatment-monitor","vec__76360","map__76363","_","predict-prostate.state.run-time/on-screen-treatments-cursor","vec__76378","map__76381","predict-prostate.mixins/set-default","pubsub.feeds/publish","predict-prostate.state.run-time/input-change","temp__5733__auto__","cljs.core/deref","val","predict-prostate.state.run-time/input-cursor","predict-prostate.state.config/get-input-default","predict-prostate.state.config/input-groups"],"sourcesContent":["(ns predict-prostate.mixins\n  (:require [clojure.set :refer [difference]]\n            [predict-prostate.state.run-time :refer [force-recalculation input-change input-cursor]]\n            [predict-prostate.state.config :refer [get-input-default input-groups]]\n            [pubsub.feeds :refer [publish]]\n            [predict-prostate.state.run-time :refer [on-screen-inputs-cursor on-screen-treatments-cursor input-map]]))\n\n(defn arg-local\n  \"Works like the rum/local mixin, but the initial value is taken\n  from component args rather than passed in as a mixin parameter.\n  If called with a key, that key is used to store the local state atom.\n  If initial is a function it is used to locate the arg needed in :rum/args,\n  else it is treated as an initial value.\"\n  ([initial]\n   (arg-local initial ::value))\n\n  ([initial key]\n   {:init (fn [{:keys [args :rum/args] :as state}]\n            (assoc state key (atom (if (fn? initial)\n                                     (apply initial args)\n                                     initial))))}))\n\n(def sizing-mixin\n  \"allow a rum component to access its rendered size\"\n  {:will-mount   (fn [state] (assoc state :width (atom 100) :height (atom 100) :resizer (atom nil)))\n   :did-mount    (fn [state]\n                   (let [node (js/ReactDOM.findDOMNode (:rum/react-component state))\n                         resize #(do\n                                   (reset! (:width state) (.-clientWidth node))\n                                   (reset! (:height state) (.-clientHeight node)))]\n                     (.addEventListener js/window \"resize\" resize)\n                     (reset! (:resizer state) resize)\n                     (resize)\n                     state))\n   :will-unmount (fn [state]\n                   (.removeEventListener js/window \"resize\" (:resizer state))\n                   state)})\n\n\n\n(def active-monitor\n  \"Since the inputs are configurable and sometimes hidden, we need to actively monitor which ones are on screen at\n  any one time. This is so we know when to switch on treatments.\"\n  {\n   :did-mount    (fn [state]\n                   (let [[{:keys [key]}] (:rum/args state)]\n                     (swap! on-screen-inputs-cursor conj key)\n                     (publish force-recalculation nil)\n                     )\n                   state)\n   :will-unmount (fn [state]\n                   (let [[{:keys [key]}] (:rum/args state)]\n                     (swap! on-screen-inputs-cursor disj key)\n                     (publish force-recalculation nil))\n                   state)\n   })\n\n\n(def treatment-monitor\n  \"A mixin which keeps track of treatment inputs present in the user interface.\n  Currently tracks both fully qualified treatments (with a treatment options suffix)\n  and treatments with this suffix stripped off.\"\n  {\n   :did-mount    (fn [state]\n                   (let [[{:keys [key]} _] (:rum/args state)]\n                     (swap! on-screen-treatments-cursor conj key))\n                   state)\n   :will-unmount (fn [state]\n                   (let [[{:keys [key]} _] (:rum/args state)]\n                     (swap! on-screen-treatments-cursor disj #{key}))\n                   state)\n   })\n\n\n\n(defn set-default [key]\n  \"If an input is unmounted and remounted, it should take it's default value on remount from the app state.\n  If it's mounted fresh, it should take its default from the configured default.\"\n  {:did-mount (fn [state]\n                (publish (input-change key) (if-let [val @(input-cursor key)]\n                                              val\n                                              (get-input-default input-groups key)))\n                state)})"]}