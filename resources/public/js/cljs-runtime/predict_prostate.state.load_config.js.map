{"version":3,"sources":["predict_prostate/state/load_config.cljs"],"mappings":"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","names":["predict-prostate.state.load-config/widget-options","cljs.core.into","cljs.core.map","g","predict-prostate.state.config/input-groups","rum.core/build-defc","p__70916","map__70918","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply","cljs.core/hash-map","cljs.core.get","attrs70913","js/React.createElement","cljs.core/map?","sablono.interpreter/attributes","sablono.interpreter/interpret","predict-prostate.state.load-config/default","rum.core/static","key","label","type","params","extra","cljs.core.pr_str","js/predict-prostate","js/predict-prostate.state","js/predict-prostate.state.load-config","js/predict-prostate.state.load-config.make-widget","method-table__4619__auto__","cljs.core.atom","prefer-table__4620__auto__","method-cache__4621__auto__","cached-hierarchy__4622__auto__","hierarchy__4623__auto__","fexpr__70922","cljs.core/MultiFn","cljs.core.symbol","predict-prostate.state.load-config/make-widget","p__70924","map__70926","p__70932","map__70933","unknowable","ttt","G__70937","G__70938","predict-prostate.components.button/information","predict-prostate.state.run-time/input-cursor","p__70942","map__70943","G__70947","G__70948","predict-prostate.components.button/radio-button-group","p__70952","map__70953","G__70957","G__70958","predict-prostate.components.button/radio-button-group-vertical","p__70963","map__70965","G__70968","wc-rum-lib.numeric-input/numeric-input","p1__70960#","cljs.core.assoc","cljs.core/name","pubsub.feeds/publish","predict-prostate.state.run-time/input-change","p__70971","map__70972","G__70974","p1__70970#","G__70975","predict-prostate.components.select/picker","predict-prostate.state.load-config/build-input-widgets-in","old-wiring","groups","cljs.core.reduce","m","map__70983","widget-type","widget-params","cljs.core/assoc-in","predict-prostate.state.load-config/render-widget","map__70987","options","predict-prostate.state.load-config/add-input-group","ref","map__70991","read-only","write-only","rum.core/cursor-in","pubsub.feeds/->Topic","predict-prostate.state.run-time/event-bus","js/predict-prostate.state.load-config.once-only-guard","predict-prostate.state.load-config/once-only-guard","cljs.core.swap_BANG_","predict-prostate.state.run-time/rtdb","cljs.core/assoc","p1__70995#","cljs.core/update","predict-prostate.state.load-config/live-keys-by-model","model","p1__70996#","cljs.core.filter","fexpr__70998"],"sourcesContent":["(ns predict-prostate.state.load-config\n  (:require\n    [rum.core :as rum]\n    [pubsub.feeds :refer [->Topic publish subscribe unsubscribe]]\n    [predict-prostate.state.config :refer [input-groups]]\n    [predict-prostate.state.run-time :refer [rtdb\n                                             input-cursor\n                                             input-cursors\n                                             input-change\n                                             estimates\n                                             event-bus\n                                             ]]\n\n    [predict-prostate.components.button :refer [radio-button-group radio-button-group-vertical information]]\n    [predict-prostate.components.select :refer [picker]]\n    [wc-rum-lib.numeric-input :refer [numeric-input]]\n    ;[predict-prostate.components.numeric-input :refer [numeric-input]]\n    ))\n\n; Make a map of all the widget group options\n(def widget-options (into {} (map (fn [g] [(:key g) g]) input-groups)))\n\n(rum/defc default < rum/static [{:keys [key label type params]} & extra]\n  [:div (pr-str \"Unknown widget \" key label type params extra)])\n\n(defmulti make-widget :type)\n\n(defmethod make-widget :default [params]\n  (default params))\n\n(defmethod make-widget :string [{:keys [params]}]\n  [:div {:style {:padding-top \"10px\" :font-size \"16px\"}} params])\n\n;; (comment\n;;   (->Input-group :ethnicity\n;;                  \"Ethnic Origin\"\n;;                  :information\n;;                  nil\n;;                  false false true\n;;                  :prp\n;;                  #{\"prostate\" \"prostate-release\"}\n;;                  \"See FAQs\"))\n\n(defmethod make-widget :information [{:keys [key label params unknowable ttt]}]\n  (information\n    {:key               key\n     :aria-label        label\n     :aria-described-by \"todo\"\n     :values            params\n     ;:values            (second params)\n     :ttt               ttt\n     ;:ttt-key           (first params)\n     :unknowable        unknowable}\n    (input-cursor key))\n  )\n\n(defmethod make-widget :radio-group [{:keys [ttt key label params unknowable]}]\n  (radio-button-group\n    {:ttt               ttt\n     :key               key\n     :aria-label        label\n     :aria-described-by \"todo\"\n     :values            params\n     :unknowable        unknowable}\n    (input-cursor key)))\n\n(defmethod make-widget :radio-group-vertical [{:keys [key label params unknowable]}]\n  (radio-button-group-vertical\n    {:key               key\n     :aria-label        label\n     :aria-described-by \"todo\"\n     :values            params\n     :unknowable        unknowable}\n    (input-cursor key)))\n\n(defmethod make-widget :numeric-input [{:keys [key params]}]\n  (numeric-input (assoc params\n                   :key (name key)\n                   :input-ref (input-cursor key)\n                   :onChange #(publish (input-change key) %))))\n\n#_(defmethod make-widget :bci-numeric-input [{:keys [key params]}]\n  (numeric-input (assoc params\n                   :input-ref (input-cursor key)\n                   :max :biopsy-cores-taken\n                   :onChange #(publish (input-change key) %))))\n\n(defmethod make-widget :select [{:keys [key params]}]\n  (picker {:key key :on-change #(publish (input-change key) %)} (:menu params)))\n\n(defn build-input-widgets-in [old-wiring groups]\n  (reduce (fn [m g]\n            (let [{:keys [key label widget-type widget-params unknowable]} g]\n              (-> m\n                  (assoc-in [:widget key] (make-widget {:key        key\n                                                        :label      label\n                                                        :type       widget-type\n                                                        :params     widget-params\n                                                        :unknowable unknowable}))\n                  (assoc-in [:label key] label)\n                  )))\n          old-wiring groups))\n\n(defn render-widget\n  \"We're now rendering widgets at use rather than at initialisation.\"\n  [ttt key]\n  (let [options (widget-options key)\n        {:keys [widget-type widget-params]} options]\n    (make-widget (assoc options\n                        :type widget-type\n                        :params widget-params\n                        :ttt ttt))))\n\n(defn add-input-group\n  \"Adds the db refs on key :cursor, and mutation refs on key :change to the set of known inputs.\"\n  [ref old-wiring groups]\n  (reduce (fn [m g]\n            (let [{:keys [key read-only write-only]} g]\n              (-> m\n                  (assoc-in [:cursor key] (when-not write-only (rum/cursor-in ref [:widgets key])))\n                  (assoc-in [:change key] (when-not read-only (->Topic key event-bus)))\n                  )))\n          old-wiring groups))\n\n;;\n;; Create input widgets and load into state just once (per browser load)\n;;\n;; todo: This process a bit naff as the app-state contains react components that cannot be shown or printed or reloaded.\n;; Main benefit is that we can configure inputs using data (currently using state.config).\n;;\n(defonce once-only-guard (swap! rtdb assoc :input-config (add-input-group rtdb {} input-groups)))\n\n; add widgets\n(swap! rtdb update :input-config #(build-input-widgets-in % input-groups))\n\n(defn live-keys-by-model\n  \"The (maximal) set of input-group keys present in a model. This is derived directly from the model\n  field in the input configuration.\"\n  [model]\n  (into #{} (map :key (filter #(and ((:models %) model)) input-groups))))\n(comment\n  (live-keys-by-model \"prostate\")\n  ;=>\n  #_#{:gleason :age :h-admissions :biopsy50 :psa :plot-style :biopsy-done\n      :charlson-comorbidity :primary-rx :t-stage :grade-group :brca})\n\n\n\n\n"]}