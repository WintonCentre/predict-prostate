{"version":3,"sources":["common/data_frame.cljs"],"mappings":";AAcA,AAAA,AAAMA,AAAYC;AAAlB,AACE,AAAAC;AAAA,AAAA,AAAAC,AAAAD;AAAA,AAAAE,AAAAD,AAAA,AAAA,AAAME;AAAN,AAAAD,AAAAD,AAAA,AAAA,AAAQG;AAAR,AAAA,AAAcD,AAAE,AAACE,AAAIN,AAAEK;;;AAEzB,AAKA,AAAA,AAAME,AAAaP;AAAnB,AAAA;AAGE,AAAAQ;AAAA,AAAA,AAAAC,AAAAD;AAAA,AAAAL,AAAAM,AAAA,AAAA,AAAML;AAAN,AAAAD,AAAAM,AAAA,AAAA,AAAQJ;AAAR,AACE,AAAMK,AAAE,AAACC,AAAQX,AAAEI;AAAnB,AAAA,AACGA,AAAE,AAACQ,AAAYF,AAAEL;;;AAExB,AAOA,AAAA,AAAAQ,AAAME;AAAN,AAAA,AAAAD,AAAAD;AAAA,AAAAV,AAAAW,AAAA,AAAA,AACIV;AADJ,AAAAD,AAAAW,AAAA,AAAA,AACMT;AADN,AAAA,AAEGD,AAAE,AAACY,AAAWC,AAAEZ;;AAEnB,AAKA,AAAA,AAAMa,AACHC;AADH,AAEE,AAAAC;AAAA,AAAA,AAAAC,AAAAD;AAAA,AAAAjB,AAAAkB,AAAA,AAAA,AAAMjB;AAAN,AAAAD,AAAAkB,AAAA,AAAA,AAAQhB;AAAR,AAAA,AACGD,AAAE,AAACE,AAAI,AAAAgB;AAAA,AAAA,AAAAC,AAAAD;AAAA,AAAAnB,AAAAoB,AAAA,AAAA,AAAMC;AAAN,AAAArB,AAAAoB,AAAA,AAAA,AAAQE;AAAR,AAAY,AAAGA,AAAED;AAAI,AAAA,AAAA,AAACE,AAAc,AAACC,AAAKR,AAAQd;;;AAE9D,AAQA,AAAA,AAAMuB,AAAa5B;AAAnB,AACE,AAAA6B;AAAA,AAAA,AAAAC,AAAAD;AAAAE,AAAA,AAAA5B,AAAA2B,AAAA,AAAA;AAAA,AAAA3B,AAAA4B,AAAA,AAAA,AAAOE;AAAP,AAAA9B,AAAA4B,AAAA,AAAA,AAAUG;AAAVF,AAAA,AAAA7B,AAAA2B,AAAA,AAAA;AAAA,AAAA3B,AAAA6B,AAAA,AAAA,AAAgBG;AAAhB,AAAAhC,AAAA6B,AAAA,AAAA,AAAmBI;AAAnB,AAAA,AAA2BH,AAAG,AAAC3B,AAAIN,AAAEkC,AAAIE;;;AAE3C,AAKA","names":["common.data-frame/cell-apply","f","p__42628","vec__42629","cljs.core.nth","k","vs","cljs.core.map","common.data-frame/cell-update","p__42632","vec__42633","g","cljs.core.partial","cljs.core.map_indexed","p__42636","vec__42637","common.data-frame/cell-sums","cljs.core.reductions","cljs.core/+","common.data-frame/cell-diffs","initial","p__42641","vec__42642","p__42645","vec__42646","a","b","cljs.core.partition","cljs.core/cons","common.data-frame/cell-binary","p__42651","vec__42652","vec__42655","vec__42658","k1","vs1","k2","vs2"],"sourcesContent":["(ns common.data-frame)\n\n;;\n;; Implement a set of transducers which operate on data-frames. In this context a data-frame\n;; is a rectangular table of data in columns where each column is identified by a keyword.\n;;\n;; Example 1:\n;; (def df {:a [1 2 3] :b [4 5 6] :c [7 8 9] :d [10 11 12]})\n;;\n;; Example 2:\n;; A spreadsheet with keywords for column names\n;;\n\n\n(defn cell-apply [f]\n  (fn [[k vs]] [k (map f vs)]))\n\n(comment\n  (into {} (map (cell-apply inc)) {:a (range 10) :b (range 5 15)})\n  ;=> {:a (1 2 3 4 5 6 7 8 9 10), :b (6 7 8 9 10 11 12 13 14 15)}\n  )\n\n(defn cell-update [f]\n  \"update a cell at position k index with old value to a new value\n  given by (f k index old)\"\n  (fn [[k vs]]\n    (let [g (partial f k)]                                  ;(fn [index old] (f k index old))\n      [k (map-indexed g vs)])))\n\n(comment\n  (into {}\n    (map (cell-update (fn [k index old] (str k \"-\" index \"-\" old))))\n    {:a [1 2 3] :b [4 5 6]})\n  ;=> {:a (\":a-0-1\" \":a-1-2\" \":a-2-3\"), :b (\":b-0-4\" \":b-1-5\" \":b-2-6\")}\n  )\n\n(defn cell-sums\n  [[k vs]]\n  [k (reductions + vs)])\n\n(comment\n  (into {} (map cell-sums) '([:a [1 2 3]] [:b [4 5 6]] [:c [7 8 9]] [:d [10 11 12]]))\n  ;=> {:a (1 3 6), :b (4 9 15), :c (7 15 24), :d (10 21 33)}\n  )\n\n(defn cell-diffs\n  [initial]\n  (fn [[k vs]]\n    [k (map (fn [[a b]] (- b a)) (partition 2 1 (cons initial vs)))]))\n\n(comment\n  (into {} (map (diff-cells 0)) '([:a [0 1 2 3]] [:b [1 6 5 4]] [:c [3 3 3 4]] [:d [0 -1 -2]]))\n  ;=> {:a (0 1 1 1), :b (1 5 -1 -1), :c (3 0 0 1), :d (0 -1 -1)}\n\n  (into {} (map (diff-cells 1)) '([:a [0 1 2 3]] [:b [1 6 5 4]] [:c [3 3 3 4]] [:d [0 -1 -2]]))\n  ;=> {:a (-1 1 1 1), :b (0 5 -1 -1), :c (2 0 0 1), :d (-1 -1 -1)}\n  )\n\n(defn cell-binary [f]\n  (fn [[[k1 vs1] [k2 vs2]]] [k1 (map f vs1 vs2)]))\n\n(comment\n  (into {} (map (cell-binary +)) [[[:a (range 10)] [:b (range 5 15)]] [[:a (range 5 15)] [:b (range 10)]]])\n  )\n\n\n(comment\n\n  ;; compose transducers\n  (def xf (comp\n            (map (cell-apply inc))\n            (map cell-sums)\n            (map (cell-diffs 0))\n            (map (cell-apply dec))\n            ))\n  (into {} xf {:a (range 10) :b (range 5 15)})\n  ; {:a (0 1 2 3 4 5 6 7 8 9), :b (5 6 7 8 9 10 11 12 13 14)}\n\n  (def a (transduce xf conj {:a (range 10) :b (range 5 15)}))\n  (def r (eduction xf {:a (range 10) :b (range 5 15)}))\n\n  ;; The mapping transducer (mapping f) is equivalent to (map f)\n  ;; https://stackoverflow.com/questions/32822207/eduction-vs-transducer-composition\n  (defn mapping\n    ([f]\n     (fn [rf]\n       (fn\n         ([] (rf))\n         ([result] (rf result))\n         ([result input]\n          (rf result (f input)))))))\n\n  ;; experimenting with eduction\n\n  )\n\n"]}